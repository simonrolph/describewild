```{r}
install.packages("googlesheets")
library(googlesheets)

install.packages("tidyverse")
install.packages("readr")
library(tidyverse)
library(dplyr)
library("curl")
library(readr)

gs_ls()

```


```{r}
# read in all the google sheets data
wildfilm <- gs_title("Wildfilm spreadsheet")
media_data <- wildfilm %>% gs_read(ws="media")
species_data <- na.omit(wildfilm %>% gs_read(ws="species"))

# make data more readable, add new columns etc
yt_image_template <- c("https://i1.ytimg.com/vi/insert_video_id/mqdefault.jpg")
yt_media_template <- c("//www.youtube.com/watch?v=insert_video_id")

#videos
for(i in 1:nrow(media_data)){
  print(i)
  if(media_data$format[i] == "V"){
    media_data$image_url[i] <- gsub("insert_video_id",media_data$video_id[i],yt_image_template)
    
    media_data$media_url[i] <- gsub("insert_video_id",media_data$video_id[i],yt_media_template)
    media_data$media_icon[i] <- "play-circle"
    media_data$media_type[i] <- "Video"
  } else if (media_data$format[i] == "P"){
    media_data$media_icon[i] <- "headphones"
    media_data$media_type[i] <- "Podcast"
  } else if (media_data$format[i] == "P"){
    media_data$media_icon[i] <- "font"
    media_data$media_type[i] <- "Blog post"
  }
}


page <- readLines("~/describewild/index_template.html")
page <- paste(page, collapse = '')
  
media_template <- gsub(".*START|END.*", "", page)
page <- gsub( " *\\START.*?\\END *", "insert_medias",page)

medias <- ""

for(i in 1:nrow(media_data)){
  media_temp <- media_template
  
  for (ii in 1:ncol(media_data)){
    field <- colnames(media_data)[ii]
    media_temp <- gsub(paste("insert",field,sep = "_"),
         media_data[i,ii],
         media_temp)
  }
  
  medias <- paste(medias,media_temp)
}

# species
species_list <- ""

for (i in 1:nrow(species_data)){
  species_list <- paste(species_list,'"',species_data$common_name[i]," (",species_data$scientific_name[i],')"',sep = "")
  
  if (i < nrow(species_data)){
    species_list <- paste(species_list,",")
  }
}






page <- gsub("insert_medias",medias,page)
page <- gsub("insert_update_date",Sys.Date(),page)
page <- gsub("insert_species_list",species_list,page)
write(page,file = "~/describewild/index.html")
 
```

